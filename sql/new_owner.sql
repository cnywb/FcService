--（本批次去重）从FC_DMS_TO_DATA_TEMP去重后保存到Fc_Dms_To_Data
insert into Fc_Dms_To_Data  (select owner_id,brand,serise,model,color, vin,engine_no,radio_no,key_no,lisence_no,sales_date,dealer_sale_code, short_name,dealer_id,dealer_name,seller,guarantee_start_date,guarantee_end_date, is_delay_service,is_wholesale,use_type,pay_type,inmileage,last_maintain_date, invoice_no,owner_name,contactor_name,owner_spell,owner_property,gender,birthday, certificate_type,certificate_code,industry_first,industry_second,family_income, edu_level,owner_marriage,choose_reasion,buy_purpose,wish_connect_type,province, city,district,zip_code,address,e_mail,phone,fax,mobile,contactor_mobile, contactor_phone,contactor_email,remark,create_date,update_date,import_date, time_stamp,sequnce,is_valid,buy_type,car_dsid,car_source,dealer_service_code, confgation,cat_code,contactor_address,contactor_gender,sale_date,is_new_owner, ob_count,is_owner_error,create_owner_date,no_ob_str,ob_type,car_sync,car_ea, catecode,no_ob_reason,data_id,dup_type,’’,IS_ODP_UPDATES,SALE_DEALER_CODE,SALE_SERVICE_CODE,SALE_DEALER_NAME from (select d.*,rank() over(partition by d.vin order by d.CREATE_DATE desc, d.data_id) cnt  from FC_DMS_TO_DATA_TEMP d) p where p.cnt = 1 ) 


--从FC_DMS_TO_DATA中提取9天之内清洗的新车主数据到FC_DMS_TO_DATA_TEMP表中
insert into fc_dms_to_data_temp   (OWNER_ID,BRAND,SERISE,MODEL,COLOR,VIN,ENGINE_NO,RADIO_NO,KEY_NO,LISENCE_NO,SALES_DATE,DEALER_SALE_CODE,SHORT_NAME,DEALER_ID,DEALER_NAME,SELLER,GUARANTEE_START_DATE,GUARANTEE_END_DATE,IS_DELAY_SERVICE,IS_WHOLESALE,USE_TYPE,  PAY_TYPE,INMILEAGE,LAST_MAINTAIN_DATE,INVOICE_NO,OWNER_NAME,CONTACTOR_NAME,OWNER_SPELL,OWNER_PROPERTY,GENDER,BIRTHDAY,CERTIFICATE_TYPE,CERTIFICATE_CODE,INDUSTRY_FIRST,INDUSTRY_SECOND,FAMILY_INCOME,EDU_LEVEL,  OWNER_MARRIAGE,CHOOSE_REASION,BUY_PURPOSE,WISH_CONNECT_TYPE,PROVINCE,CITY,DISTRICT,ZIP_CODE,ADDRESS,E_MAIL,PHONE,FAX,MOBILE,CONTACTOR_MOBILE,CONTACTOR_PHONE,CONTACTOR_EMAIL,  REMARK, create_date,UPDATE_DATE,IMPORT_DATE,TIME_STAMP,SEQUNCE,IS_VALID,BUY_TYPE,CAR_DSID,CAR_SOURCE,DEALER_SERVICE_CODE,CONFGATION,CAT_CODE,CONTACTOR_ADDRESS,CONTACTOR_GENDER,SALE_DATE,IS_NEW_OWNER,OB_COUNT,  IS_OWNER_ERROR,CREATE_OWNER_DATE,NO_OB_STR,OB_TYPE  ,CAR_SYNC  ,CAR_EA  ,CATECODE  ,NO_OB_REASON  ,DATA_ID  ,DUP_TYPE,IS_ODP_UPDATES,sale_dealer_code,sale_service_code,sale_dealer_name  )   select OWNER_ID,BRAND,SERISE,MODEL,COLOR,VIN,ENGINE_NO,RADIO_NO,KEY_NO,LISENCE_NO,SALES_DATE,DEALER_SALE_CODE,SHORT_NAME,DEALER_ID,DEALER_NAME,SELLER,GUARANTEE_START_DATE,GUARANTEE_END_DATE,IS_DELAY_SERVICE,IS_WHOLESALE,  USE_TYPE,PAY_TYPE,INMILEAGE,LAST_MAINTAIN_DATE,INVOICE_NO,OWNER_NAME,CONTACTOR_NAME,OWNER_SPELL,OWNER_PROPERTY,GENDER,BIRTHDAY,CERTIFICATE_TYPE,CERTIFICATE_CODE,INDUSTRY_FIRST,INDUSTRY_SECOND,FAMILY_INCOME,EDU_LEVEL  ,  OWNER_MARRIAGE  ,CHOOSE_REASION  ,BUY_PURPOSE  ,WISH_CONNECT_TYPE  ,PROVINCE  ,CITY  ,DISTRICT  ,ZIP_CODE  ,ADDRESS  ,E_MAIL  ,PHONE  ,FAX  ,MOBILE  ,CONTACTOR_MOBILE  ,CONTACTOR_PHONE  ,CONTACTOR_EMAIL  ,REMARK  ,create_date ,UPDATE_DATE  ,IMPORT_DATE  ,TIME_STAMP  ,SEQUNCE  ,IS_VALID  ,BUY_TYPE  ,CAR_DSID  ,CAR_SOURCE  ,DEALER_SERVICE_CODE  ,  CONFGATION  ,CAT_CODE  ,CONTACTOR_ADDRESS  ,CONTACTOR_GENDER  ,SALE_DATE  ,IS_NEW_OWNER  ,OB_COUNT  ,IS_OWNER_ERROR  ,CREATE_OWNER_DATE  ,  NO_OB_STR  ,OB_TYPE  ,CAR_SYNC  ,CAR_EA  ,CATECODE  ,NO_OB_REASON  ,DATA_ID  ,  DUP_TYPE,IS_ODP_UPDATES,sale_dealer_code,sale_service_code,sale_dealer_name  from   ( select c.*,row_number() OVER (PARTITION BY vin ORDER BY c.CREATE_DATE desc) AS NUM  FROM FC_DMS_TO_DATA c  where to_date(c.CREATE_OWNER_DATE,'yyyyMMDD')>=to_date('start_date','yyyyMMDD')  and  to_date(c.CREATE_OWNER_DATE,'yyyyMMDD')<=to_date('end_date','yyyyMMDD')  and substr(c.sale_date, 0, 10) =to_char(to_date('start_date','yyyymmdd'),'yyyy-mm-dd')   and c.DEALER_SALE_CODE=c.sale_dealer_code  ) d WHERE d.NUM=1 

--FC,ODP,CSI数据去重
 PROC_FC_DMS_TO_DATA_TEMP_QC
 
--从FC_DMS_TO_DATA_TEMP查出新车主
select  OWNER_ID,BRAND,SERISE,MODEL,COLOR,VIN,ENGINE_NO,RADIO_NO,KEY_NO,LISENCE_NO,SALES_DATE,DEALER_SALE_CODE,SHORT_NAME,DEALER_ID,DEALER_NAME, SELLER,GUARANTEE_START_DATE,GUARANTEE_END_DATE,IS_DELAY_SERVICE,IS_WHOLESALE,USE_TYPE,   PAY_TYPE,INMILEAGE,LAST_MAINTAIN_DATE,INVOICE_NO,OWNER_NAME,CONTACTOR_NAME,OWNER_SPELL, OWNER_PROPERTY,GENDER,BIRTHDAY,CERTIFICATE_TYPE,CERTIFICATE_CODE,INDUSTRY_FIRST,INDUSTRY_SECOND,FAMILY_INCOME,EDU_LEVEL,   OWNER_MARRIAGE,CHOOSE_REASION,BUY_PURPOSE,WISH_CONNECT_TYPE,PROVINCE,CITY,DISTRICT,ZIP_CODE,ADDRESS,E_MAIL,PHONE, FAX,MOBILE,CONTACTOR_MOBILE,CONTACTOR_PHONE,CONTACTOR_EMAIL,  REMARK,CREATE_DATE,UPDATE_DATE,IMPORT_DATE,TIME_STAMP,SEQUNCE,IS_VALID,BUY_TYPE,  CAR_DSID,CAR_SOURCE,DEALER_SERVICE_CODE,CONFGATION,CAT_CODE,CONTACTOR_ADDRESS,CONTACTOR_GENDER,SALE_DATE,IS_NEW_OWNER,OB_COUNT,  IS_OWNER_ERROR,CREATE_OWNER_DATE,NO_OB_STR,OB_TYPE  ,CAR_SYNC  ,CAR_EA  ,CATECODE  ,NO_OB_REASON  ,DATA_ID  ,DUP_TYPE,IS_ODP_UPDATES,SALE_DEALER_CODE,SALE_SERVICE_CODE,SALE_DEALER_NAME   from FC_DMS_TO_DATA_TEMP 
 